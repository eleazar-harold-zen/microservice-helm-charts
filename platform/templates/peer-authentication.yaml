{{- if .Values.peerAuthentication.enabled }}
# Peer Authentication template
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: {{ .Values.peerAuthentication.name }}
  namespace: {{ .Values.peerAuthentication.namespace }}
spec:
    selector:
        matchLabels:
        {{ with .Values.peerAuthentication.app }}
        app: {{ .  }}
        {{- end }}
        {{ with .Values.peerAuthentication.workload }}
        workload: {{ . }}
        {{- end }}
    mtls:
        # https://istio.io/latest/docs/reference/config/security/peer_authentication/#PeerAuthentication-MutualTLS-Mode
        mode: {{ default "PERMISSIVE" .Values.peerAuthentication.mode }} # STRICT, PERMISSIVE, DISABLE
{{- end }}
